<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ã¨ã†ã›ã„ã®è¬</title>
<style>
  :root{
    --bg:#fff7fb; --card:#ffffff; --text:#2a2a2a; --muted:#6b7280;
    --accent:#ff7ac6; --ok:#16a34a; --ng:#ef4444; --ring:#ffd5ec;
    --gold:#ffcc66; --spark:#fff2a8;
  }
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#fff7fb 0%, #f5fbff 100%);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    -webkit-tap-highlight-color:transparent;
  }
  .wrap{max-width:900px; margin:0 auto; padding:20px 16px 64px;}
  header{display:flex; align-items:center; gap:12px; margin:6px 0 10px;}
  header h1{font-size:26px; margin:0;}
  .mascot{width:40px; height:40px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.08);}
  .card{background:var(--card); border-radius:20px; box-shadow:0 10px 24px rgba(255,122,198,.15);
        padding:18px; margin:14px 0; border:2px solid var(--ring);}
  .question{font-size:20px; font-weight:700; margin:8px 0 4px;}
  .lead{color:var(--muted); margin-top:2px;}
  .choices{display:grid; gap:10px; margin-top:12px;}
  .choice-btn{width:100%; text-align:left; padding:14px 16px; border-radius:16px; border:2px solid #e7f2ff; background:#fff; cursor:pointer; font-size:16px;}
  .choice-btn:hover{border-color:#cfe7ff; background:#f7fbff;}
  .result{margin-top:10px; font-weight:800; font-size:18px;}
  .ok{color:var(--ok);} .ng{color:var(--ng);}
  .subtitle{font-weight:800; color:#1f2937; margin:6px 0 10px; font-size:18px;}
  .muted-box{background:#fff5fa; border:2px dashed #ffd2ea; padding:10px 12px; border-radius:14px; color:#374151;}
  .explain{margin-top:12px; text-align:left; background:#f7fbff; border:2px solid #dbeafe; border-radius:14px; padding:12px;}
  .fade{animation:fade .25s ease;}
  @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media (max-width:560px){
    header h1{font-size:22px}
    .question{font-size:18px}
    .choice-btn{font-size:15px; padding:14px}
    .btn{width:100%}
  }

  /* ãƒœã‚¿ãƒ³ */
  .btn{
    display:inline-block; padding:14px 18px; border-radius:16px; border:none; cursor:pointer; font-size:16px;
    background:linear-gradient(90deg,var(--accent),#ffa7d8); color:#fff; box-shadow:0 8px 18px rgba(255,122,198,.35);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}
  .btn.alt{background:linear-gradient(90deg,#8ec5ff,#b5e1ff);}

  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆç¸¦ä¸¦ã³ï¼‰ */
  .form-vertical{display:flex; flex-direction:column; gap:12px;}
  label{font-size:14px; color:var(--muted); margin-bottom:6px;}
  input{
    width:100%; padding:14px 14px; font-size:16px; border-radius:14px; border:2px solid #ffdff0; background:#fff; outline:none;
  }
  input:focus{border-color:#ffb3dc; box-shadow:0 0 0 4px #ffe6f4;}

  /* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆç´¹ä»‹ï¼‰ */
  .hero{
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px;
  }
  .hero img{ width:min(68vw, 300px); height:auto; border-radius:24px; box-shadow:0 10px 26px rgba(0,0,0,.12); }
  .speech{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:18px; padding:12px 14px; line-height:1.7;
    position:relative; max-width:680px;
  }
  .speech:after{
    content:""; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffd5ec;
  }
  .speech:before{
    content:""; position:absolute; top:calc(100% + 2px); left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffffff;
  }

  /* æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— */
  .stamp{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.75); z-index:50;}
  .stamp img{width:min(70vw,380px); height:auto; filter:drop-shadow(0 10px 24px rgba(0,0,0,.2)); animation:pop .5s ease;}
  @keyframes pop{0%{transform:scale(.6) rotate(-6deg); opacity:0}60%{transform:scale(1.05) rotate(2deg); opacity:1}100%{transform:scale(1) rotate(0)}}

  /* ===== ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è±ªè¯ç‰ˆ ===== */
  #screen-ending{ position:relative; overflow:hidden; }
  .ending-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
  .ending-hero{
    width:min(80vw, 420px); height:auto;
    border-radius:28px; box-shadow:0 18px 40px rgba(255,122,198,.35);
    outline:6px solid rgba(255, 213, 236, .6);
  }
  .ending-title{
    font-size:24px; font-weight:900; letter-spacing:.02em;
    background:linear-gradient(90deg,#ff7ac6,#ffcc66); -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .ending-lines{
    line-height:1.9; font-size:16px; color:#374151;
    background:#fffef3; border:2px solid #ffefb6; border-radius:16px; padding:10px 14px;
  }
  .ending-badge{
    display:inline-block; padding:8px 12px; border-radius:999px;
    background:linear-gradient(90deg,#ffd591,#ffe9b6); color:#6b4000; font-weight:800; font-size:13px;
    border:1px solid #f6c66f; box-shadow:0 6px 16px rgba(255,204,102,.35);
  }
  .ending-actions{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; justify-content:center; }
  .btn.ghost{
    background:#fff; color:#ff4fae; border:2px solid #ffb4df; box-shadow:none;
  }

  /* ç´™å¹é›ª */
  .confetti{ pointer-events:none; position:absolute; inset:0; overflow:hidden; }
  .confetti span{
    position:absolute; top:-10px; width:10px; height:16px; opacity:.9;
    animation:fall 2.8s linear forwards; transform:rotate(0deg);
  }
  @keyframes fall{
    0%{ transform:translateY(-10px) rotate(0deg); }
    100%{ transform:translateY(120vh) rotate(540deg); }
  }
  /* ã‚­ãƒ©ã‚­ãƒ© */
  .sparkles{ pointer-events:none; position:absolute; inset:0; }
  .spark{
    position:absolute; width:10px; height:10px; background:radial-gradient(circle, var(--spark) 0%, rgba(255,255,255,0) 70%);
    animation:blink 1.6s ease-in-out infinite;
  }
  @keyframes blink{ 0%,100%{opacity:0.2} 50%{opacity:1} }

  /* ===== å ã„æ¼”å‡ºï¼ˆçµæœãƒšãƒ¼ã‚¸ï¼‰ ===== */
  .fortune-wrap{
    display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:10px;
  }
  .tarot-hero{
    width:min(62vw, 260px); height:auto; border-radius:22px;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
    outline:4px solid rgba(255,213,236,.6);
  }
  .fortune-lines{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:16px; padding:10px 12px; line-height:1.9;
    min-height:72px; max-width:680px; text-align:left;
  }
  .fortune-line{ opacity:0; transform:translateY(4px); animation:fade .3s ease forwards; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="mame.png" alt="ã¾ã‚ãƒã‚¹ã‚³ãƒƒãƒˆ" class="mascot" />
      <h1>ğŸ¯ ã¨ã†ã›ã„ã®è¬</h1>
    </header>

    <!-- å…¥åŠ›ç”»é¢ -->
    <section id="screen-intro" class="card fade">
      <div class="hero">
        <img src="mame.png" alt="ã¨ã›ã„ãã‚“" />
        <div class="speech">
          <strong>ã¼ãã¯ ã¨ã›ã„ãã‚“ã€‚</strong><br>
          å°‚é–€ãƒ»èªå®šçœ‹è­·å¸«ä¼šã® <strong>è¬è§£ãä¿‚</strong> ã ï¼<br>
          åæ¢åµã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚<br>
          <strong>ã‚ãªãŸã®ã“ã¨ã€æ•™ãˆã¦ï¼</strong>
        </div>
      </div>

      <div style="height:8px;"></div>

      <div class="form-vertical">
        <div>
          <label for="name">åå‰</label>
          <input id="name" type="text" placeholder="ä¾‹ï¼‰ã¾ã‚ãŠ" />
        </div>
        <div>
          <label for="group">æ‰€å±</label>
          <input id="group" type="text" placeholder="ä¾‹ï¼‰å¤–æ¥ï¼ç—…æ£Ÿï¼ãƒªãƒ ãªã©" />
        </div>
        <div>
          <label for="job">è·ç¨®</label>
          <input id="job" type="text" placeholder="ä¾‹ï¼‰çœ‹è­·å¸«ï¼åŒ»å¸«ï¼è–¬å‰¤å¸« ãªã©" />
        </div>
      </div>

      <div style="margin-top:16px;">
        <button class="btn" id="go-pre">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <section id="screen-pre" class="card fade" style="display:none;">
      <div id="pre-title" class="subtitle"></div>
      <div class="muted-box" style="margin:10px 0 14px;">
        ğŸ”® <strong>ã‚ãªãŸã®â€œæ¢åµå ã„â€</strong><br/>
        ç›´æ„Ÿã§é¸ã‚“ã ç­”ãˆãŒã€ã‚ãªãŸã®<strong>æ¨ç†ã‚¹ã‚¿ã‚¤ãƒ«</strong>ã‚’æ˜ ã—å‡ºã™â€¦ï¼<br/>
        ã¨ã›ã„å ã„ã€ã¯ã˜ã¾ã‚‹ã‚ˆã€‚
      </div>
      <button class="btn alt" id="begin-diag">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
    </section>

    <!-- è¨ºæ–­ï¼ˆ3å•ï¼‰ -->
    <section id="screen-diag" class="card fade" style="display:none;">
      <div class="question" id="diag-q"></div>
      <div class="choices" id="diag-choices"></div>
      <div class="lead" id="diag-progress" style="margin-top:8px;"></div>
    </section>

    <!-- è¨ºæ–­çµæœï¼ˆå ã„æ¼”å‡ºè¿½åŠ ï¼‰ -->
    <section id="screen-diag-result" class="card fade" style="display:none;">
      <div id="type-title" class="question"></div>
      <div id="type-copy" class="lead"></div>

      <!-- å ã„æ¼”å‡ºï¼šã‚¿ãƒ­ãƒƒãƒˆã¨å£ä¸Š -->
      <div class="fortune-wrap">
        <img src="mame.png" alt="ã‚¿ãƒ­ãƒƒãƒˆã‚’æŒã¤ã¨ã›ã„ãã‚“" class="tarot-hero" />
        <div id="fortune-lines" class="fortune-lines"></div>
      </div>

      <ul id="type-desc" style="text-align:left; line-height:1.8;"></ul>
      <div class="muted-box" style="margin-top:12px;">
        ã‚ãªãŸã®æ¢åµã‚¿ã‚¤ãƒ—ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<br/>
        ãã®å€‹æ€§ã‚’æ´»ã‹ã—ã¦<strong>ã¨ã†ã›ã„ã®è¬</strong>ã«æŒ‘ã‚‚ã†ï¼
      </div>
      <button class="btn" id="to-quiz" style="margin-top:14px;">ç¬¬1å•ã¸é€²ã‚€</button>
    </section>

    <!-- æœ¬ç·¨Q1ã€œQ3 -->
    <section id="screen-quiz" class="card fade" style="display:none;">
      <div id="story" class="lead" style="margin-bottom:8px;"></div>
      <div style="text-align:center; margin:10px 0;">
        <img id="quiz-img" src="" alt="è¬ã®ç”»åƒ" style="max-width:100%; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
      </div>
      <div id="q-title" class="question"></div>
      <div id="choices" class="choices"></div>
      <div id="judge" class="result"></div>
      <div id="explain" class="explain" style="display:none;"></div>
      <div id="next-area" style="display:none; margin-top:12px;">
        <button id="next-btn" class="btn">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚° -->
    <section id="screen-ending" class="card fade" style="display:none;">
      <div class="ending-wrap">
        <div class="ending-title">ğŸ‰ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼</div>
        <img src="mame.png" alt="ã¨ã›ã„ãã‚“" class="ending-hero" />
        <div class="ending-lines">
          <div class="ending-badge">ã¨ã†ã›ã„ã®è¬ãƒ»åæ¢åµèªå®š</div>
          <div id="ending-text" style="margin-top:6px;"></div>
          <div style="margin-top:6px;">
            12æœˆã¯ <strong>TMCï¼ˆã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰</strong> ã«æ³¨ç›®ã ï¼ï¼ğŸ†âœ¨
          </div>
        </div>
        <div class="ending-actions">
          <button class="btn ghost" id="finish-btn">ä»Šå›ã®èª¿æŸ»ã‚’çµ‚äº†ã™ã‚‹</button>
        </div>
        <div id="finish-message" style="display:none; margin-top:10px; font-weight:800; color:#374151;">
          ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
      <div class="sparkles" id="sparkles"></div>
    </section>
  </div>

  <!-- æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— -->
  <div id="stamp" class="stamp" aria-hidden="true">
    <img src="nazotoki2.png" alt="æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ—" />
  </div>

  <!-- ã‚µã‚¦ãƒ³ãƒ‰ -->
  <audio id="bgm" src="nazotoki.mp3" preload="none" loop></audio>
  <audio id="seClick" src="pochi.mp3" preload="auto"></audio>
  <audio id="seCorrect" src="pinpon.mp3" preload="auto"></audio>
  <!-- â˜… è¿½åŠ ï¼šã‚¯ãƒªã‚¢æ™‚ã®ã‚µã‚¦ãƒ³ãƒ‰ -->
  <audio id="seClear" src="seikou.mp3" preload="auto"></audio>

<script>
  // ===== DOM =====
  const nameEl  = document.getElementById('name');
  const screenIntro = document.getElementById('screen-intro');
  const screenPre   = document.getElementById('screen-pre');
  const screenDiag  = document.getElementById('screen-diag');
  const screenDiagResult = document.getElementById('screen-diag-result');
  const screenQuiz  = document.getElementById('screen-quiz');
  const screenEnding= document.getElementById('screen-ending');
  const preTitle = document.getElementById('pre-title');
  const stampEl = document.getElementById('stamp');

  const diagQEl = document.getElementById('diag-q');
  const diagChoicesEl = document.getElementById('diag-choices');
  const diagProgEl = document.getElementById('diag-progress');

  const storyEl = document.getElementById('story');
  const qTitleEl = document.getElementById('q-title');
  const choicesEl = document.getElementById('choices');
  const judgeEl = document.getElementById('judge');
  const explainEl = document.getElementById('explain');
  const nextArea = document.getElementById('next-area');
  const nextBtn  = document.getElementById('next-btn');
  const endingText = document.getElementById('ending-text');
  const quizImgEl = document.getElementById('quiz-img');
  const confettiEl = document.getElementById('confetti');
  const sparklesEl = document.getElementById('sparkles');

  // å ã„æ¼”å‡ºDOM
  const fortuneLinesEl = document.getElementById('fortune-lines');

  // çµ‚äº†ãƒœã‚¿ãƒ³
  const finishBtn = document.getElementById('finish-btn');
  const finishMessage = document.getElementById('finish-message');

  // ===== Sound =====
  const bgm = document.getElementById('bgm');
  const seClick = document.getElementById('seClick');
  const seCorrect = document.getElementById('seCorrect');
  const seClear = document.getElementById('seClear');
  let bgmStarted = false;

  function playClick(){ try{ seClick.currentTime = 0; seClick.play(); }catch{} }
  function playCorrect(){ try{ seCorrect.currentTime = 0; seCorrect.play(); }catch{} }
  function ensureBGM(){
    if(!bgmStarted){
      bgmStarted = true;
      try{ bgm.volume = 0.8; bgm.play(); }catch{}
    }
  }
  function stopAllSounds(){
    try{ bgm.pause(); bgm.currentTime = 0; }catch{}
    try{ seClick.pause(); seClick.currentTime = 0; }catch{}
    try{ seCorrect.pause(); seCorrect.currentTime = 0; }catch{}
    try{ seClear.pause(); seClear.currentTime = 0; }catch{}
    bgmStarted = false;
  }

  // â˜… ä¿®æ­£: ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã§ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚’é³´ã‚‰ã™ãŒã€é¸æŠè‚¢(.choice-btn)ã¯é™¤å¤–ã—ã¦ç«¶åˆã‚’é˜²ã
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;
    if (btn.classList.contains('choice-btn')) return; // é¸æŠè‚¢ã¯æ­£è§£/ä¸æ­£è§£ã§åˆ¥SEã‚’é³´ã‚‰ã™
    playClick();
  }, true);

  // ç”»é¢åˆ‡æ›¿
  function hideAll(){ [screenIntro,screenPre,screenDiag,screenDiagResult,screenQuiz,screenEnding].forEach(el=>el.style.display='none'); }
  function show(el){ hideAll(); el.style.display='block'; window.scrollTo({top:0, behavior:'smooth'}); }
  show(screenIntro);

  // Intro -> Pre
  document.getElementById('go-pre').addEventListener('click', ()=>{
    if(!nameEl.value.trim()){ nameEl.focus(); nameEl.style.borderColor='#ff8dc7'; return; }
    nameEl.style.borderColor='#ffdff0';
    preTitle.textContent = `ã¨ã†ã›ã„ã®è¬ã«è¿«ã‚‹${nameEl.value}æ¢åµã€Œã‚ãªãŸã¯ã©ã‚“ãªã‚¿ã‚¤ãƒ—ã®åæ¢åµï¼Ÿã€`;
    show(screenPre);
  });

  // Pre -> Diagnosis
  document.getElementById('begin-diag').addEventListener('click', ()=>{
    ensureBGM();
    diagIndex = 0; diagCounts = {A:0,B:0,C:0}; lastPick = null;
    renderDiag(); show(screenDiag);
  });

  // ===== è¨ºæ–­ =====
  const diagData = [
    { q:"è³ªå•1ï½œä¼‘æ—¥ã€ã‚ãªãŸã®éã”ã—æ–¹ã¯ï¼Ÿ",
      choices:[ {label:"Aï¼šæœ¬ã‚„æ˜ ç”»ã§é™ã‹ã«å……é›» ğŸ“š",type:"A"},
                {label:"Bï¼šæ–°åº—å·¡ã‚Šã‚„ã‚¤ãƒ™ãƒ³ãƒˆã§æƒ…å ±åé›† ğŸ—º ",type:"B"},
                {label:"Cï¼šæ°—ã®å‘ãã¾ã¾ã«æ•£æ­© ğŸŒ¿ ",type:"C"} ]},
    { q:"è³ªå•2ï½œå›°ã£ãŸã¨ãæœ€åˆã«ã™ã‚‹ã“ã¨ã¯ï¼Ÿ",
      choices:[ {label:"Aï¼šçŠ¶æ³ã‚’æ•´ç†ã—ã¦ãƒ¡ãƒ¢ âœï¸",type:"A"},
                {label:"Bï¼šè©³ã—ã„äººã«ã™ãèã ğŸ‘‚",type:"B"},
                {label:"Cï¼šã²ã¨ã¾ãšã‚„ã£ã¦ã¿ã‚‹ ğŸ’ª",type:"C"} ]},
    { q:"è³ªå•3ï½œåˆå¯¾é¢ã®äººã¨ä¼šã£ãŸã‚‰ï¼Ÿ",
      choices:[ {label:"Aï¼šè¦³å¯Ÿã—ãªãŒã‚‰è©±ã™ ğŸ‘€",type:"A"},
                {label:"Bï¼šè©±é¡Œã‚’ã©ã‚“ã©ã‚“æŒ¯ã‚‹ ğŸ—£",type:"B"},
                {label:"Cï¼šè‡ªç„¶ä½“ã§ã‚†ã£ãã‚Šä¼šè©± ğŸ˜Œ",type:"C"} ]}
  ];
  let diagIndex=0, diagCounts={A:0,B:0,C:0}, lastPick=null;

  function renderDiag(){
    const d = diagData[diagIndex];
    diagQEl.textContent = d.q;
    diagChoicesEl.innerHTML = "";
    d.choices.forEach(ch=>{
      const b = document.createElement('button');
      b.className = 'choice-btn';
      b.textContent = ch.label;
      b.onclick = ()=>{
        diagCounts[ch.type]++; lastPick = ch.type;
        if(++diagIndex < diagData.length) renderDiag(); else showTypeResult();
      };
      diagChoicesEl.appendChild(b);
    });
    diagProgEl.textContent = `(${diagIndex+1} / ${diagData.length})`;
  }

  // å ã„å°è©ã‚’1è¡Œãšã¤è¡¨ç¤º
  function renderFortune(lines){
    fortuneLinesEl.innerHTML = "";
    let i = 0;
    function next(){
      if(i >= lines.length) return;
      const div = document.createElement('div');
      div.className = 'fortune-line';
      div.textContent = lines[i++];
      fortuneLinesEl.appendChild(div);
      setTimeout(next, 900); // è¡Œé–“ã®é–“éš”
    }
    next();
  }

  function showTypeResult(){
  const max = Math.max(diagCounts.A, diagCounts.B, diagCounts.C);
  const tied = []; for (const k of ['A','B','C']) if (diagCounts[k] === max) tied.push(k);
  const main = tied.includes(lastPick) ? lastPick : tied[0];

  const typeTitle = document.getElementById('type-title');
  const typeCopy  = document.getElementById('type-copy');
  const typeDesc  = document.getElementById('type-desc'); 
  typeDesc.innerHTML = "";

  let resultName = "";
  let lines = [];

  if(main === 'A'){
    resultName = "å†·é™åˆ†æå‹æ¢åµ";
    typeTitle.textContent = resultName;
    typeCopy.textContent  = "ã€Œè¨¼æ‹ ãŒé›†ã¾ã‚‹ã¾ã§å‹•ã‹ãªã„ã€è²ã‚¿ã‚¤ãƒ—ã€";
    lines = [
      "ãµã‚€ãµã‚€â€¦â€¦ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™ã®ã¯â€¦â€¦",
      "å›ã¯ã€Œå†·é™åˆ†æå‹æ¢åµã€ã ã­ï¼",
      "é™ã‹ãªé›†ä¸­åŠ›ã€ãã—ã¦æ­£ç¢ºã•ãŒæ­¦å™¨ã€‚",
      "æ€¥ãŒãšã˜ã£ãã‚Šé€²ã‚ã°ã€å¿…ãšæ ¸å¿ƒã«å±Šãã‚ˆã€‚"
    ];
    appendLi(typeDesc,"ãƒ‡ãƒ¼ã‚¿æ•´ç†ã‚„ãƒ¡ãƒ¢ãŒå¾—æ„ã€‚ãƒŸã‚¹ãŒå°‘ãªã„å …å®Ÿæ´¾ã€‚");
    appendLi(typeDesc,"ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ï¼šè™«çœ¼é¡ã€ãƒãƒ¼ãƒˆ");
    appendLi(typeDesc,"ä»Šæ—¥ã®ä¸€è¨€ï¼šç„¦ã‚‰ãšã€ç¢ºã‹ã‚ã¦ã€ç©ã¿ä¸Šã’ã‚‹ã€‚");
  } else if(main === 'B'){
    resultName = "æƒ…å ±åé›†å‹æ¢åµ";
    typeTitle.textContent = resultName;
    typeCopy.textContent  = "ã€Œå™‚ã¨Wi-Fiã‚’ã™ã°ã‚„ãæ‹¾ã†ã€ã‚¢ãƒ³ãƒ†ãƒŠã‚¿ã‚¤ãƒ—ã€";
    lines = [
      "ãµã‚€ãµã‚€â€¦â€¦ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™ã®ã¯â€¦â€¦",
      "å›ã¯ã€Œæƒ…å ±åé›†å‹æ¢åµã€ã ã­ï¼",
      "å‹•ãã¯æ—©ã„ã€‚ã ãŒã€æ™‚ã«ã¯ä¼‘ã‚€ã®ã‚‚å¤§äº‹ã ã‚ˆã€‚",
      "æƒ…å ±ã®æµ·ã§æººã‚Œãªã„ã‚ˆã†ã€è¦ç‚¹ã‚’æ´ã‚ã°ç„¡æ•µï¼"
    ];
    appendLi(typeDesc,"äººè„ˆï¼†æ¤œç´¢ãŒå¼·ã¿ã€‚åºƒãæµ…ãã‹ã‚‰ã€å¿…è¦ãªæ ¸ã¸ã€‚");
    appendLi(typeDesc,"ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ï¼šã‚·ã‚¢ãƒ³ã€ãƒã‚¤ãƒ“ãƒ¼");
    appendLi(typeDesc,"ä»Šæ—¥ã®ä¸€è¨€ï¼šé€Ÿã•ï¼‹ä¸€æ¬¡æƒ…å ±ï¼æœ€å¼·ã€‚");
  } else {
    resultName = "ãƒã‚¤ãƒšãƒ¼ã‚¹å‹æ¢åµ";
    typeTitle.textContent = resultName;
    typeCopy.textContent  = "ã€Œã²ã‚‰ã‚ãã§æ ¸å¿ƒã‚’å°„æŠœãã€ã‚¹ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã€";
    lines = [
      "ãµã‚€ãµã‚€â€¦â€¦ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™ã®ã¯â€¦â€¦",
      "å›ã¯ã€Œãƒã‚¤ãƒšãƒ¼ã‚¹å‹æ¢åµã€ã ã­ï¼",
      "ã‚†ã£ãŸã‚Šã§ã‚‚ã€ã“ã“ãã®ç›´æ„Ÿã¯é‹­ã„ã€‚",
      "ãƒªã‚ºãƒ ã‚’å´©ã•ãšã€ã²ã‚‰ã‚ãã‚’ä¿¡ã˜ã‚ˆã†ã€‚"
    ];
    appendLi(typeDesc,"ç™ºæƒ³åŠ›ãŒé«˜ã„ã€‚è©°ã¾ã£ãŸã‚‰æ•£æ­©ã§è„³ã‚’ã»ããã†ã€‚");
    appendLi(typeDesc,"ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ï¼šã‚­ãƒ£ãƒ³ãƒ‡ã‚£ã€æ•£æ­©é“");
    appendLi(typeDesc,"ä»Šæ—¥ã®ä¸€è¨€ï¼šç„¦ã‚‰ãšã€ã§ã‚‚æ­¢ã¾ã‚‰ãªã„ã€‚");
  }

  // â˜… ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼šã¾ãšç”»é¢ã‚’è¡¨ç¤ºã—ã¦ç”»åƒã‚’è¦‹ã›ã‚‹ â†’ å°‘ã—é…ã‚‰ã›ã¦å°è©é–‹å§‹
  show(screenDiagResult);                 // ç”»åƒãŒå…ˆã«å‡ºã‚‹
  setTimeout(() => renderFortune(lines), 60); // å°è©ã‚’å¾Œã‹ã‚‰1è¡Œãšã¤è¡¨ç¤º
}


  // ===== æœ¬ç·¨ =====
  const quiz = [
    {
      story: "ğŸ•µï¸â€â™€ï¸ ç¬¬1ã®è¬ï¼šè¬ã®ãƒªãƒ¼ãƒ€ãƒ¼ã¯ã ã‚Œï¼Ÿ<br>ã¨ã†ã›ã„ç—…é™¢ã®é™¢é•·ãƒ»ç¦å²¡å…ˆç”Ÿã€‚24æ™‚é–“ãšã£ã¨ç—…é™¢ã«ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã§ã‚‚ã€å¤œé–“ã‚„ä¼‘æ—¥ã«æ€¥ãªãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ããŸã‚‰â€¦ï¼Ÿãã®ã¨ãã€é™¢é•·ã®ä»£ã‚ã‚Šã«ç—…é™¢å…¨ä½“ã‚’æŒ‡æ®ã™ã‚‹è¬ã®äººç‰©ãŒã„ã‚‹ã‚‰ã—ã„ãƒ»ãƒ»ãƒ»<br>ã‚ãªãŸã¯ã€ãã®äººç‰©ã®æ­£ä½“ã‚’çªãæ­¢ã‚ã‚‹ã€‚<br>å‰¯é™¢é•·ã§ã‚‚ã€çœ‹è­·å±€é•·ã§ã‚‚ã€äº‹å‹™é•·ã§ã‚‚ãªã„ã€‚<br>ã§ã‚‚å¤œã‚„ä¼‘æ—¥ã¯â€œç—…é™¢ã®é¡”â€ã«ãªã‚‹ã“ã®äººç‰©ã¯ã€èª°ã ï¼Ÿ",
      title: "æ¬¡ã®4ã¤ã®ä¸­ã‹ã‚‰æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚",
      choices: [
        {label:"å†…ç§‘ç›´", correct:true},
        {label:"å¤–ç§‘ç›´", correct:false},
        {label:"å½“ç›´å¸«é•·", correct:false},
        {label:"ERãƒªãƒ¼ãƒ€ãƒ¼", correct:false}
      ],
      explain: [
        "å¤œé–“ãƒ»ä¼‘æ—¥ã¯å†…ç§‘ç›´ãŒç—…é™¢å…¨ä½“ã®æŒ‡æ®ã‚’å–ã‚‹ã€‚",
        "æ‰‹è¡“ã‚„å¤–ç§‘ç³»ãƒˆãƒ©ãƒ–ãƒ«ã¯å¿…è¦ã«å¿œã˜ã¦å¤–ç§‘ç›´ã¨é€£æºã€‚",
        "çœ‹è­·ãƒ»äº‹å‹™ã‚‚å½“ç›´ä½“åˆ¶ãŒã‚ã‚Šã€å…¨è·ç¨®ã§ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã€‚"
      ]
    },
    {
      story: "ğŸ•µï¸â€â™€ï¸ ç¬¬2ã®è¬ï¼šè¬ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚’çªãæ­¢ã‚ãŸã‚ãªãŸã¯å†…ç§‘ç›´ã®æœºã®ä¸Šã«è¬ã®ãƒ¡ãƒ¢ã‚’ç™ºè¦‹ã—ãŸ<br>ã€Œæœã«ãªã£ã¦å¤–æ¥ãŒé–‹ãã¾ã§é ‘å¼µã‚‹ãã€ã€ã€ã‚ã‚Œï¼Ÿå¤–æ¥å—ä»˜ã®æ©Ÿæ¢°ã£ã¦ä½•æ™‚ã‹ã‚‰ã ã£ã‘ãƒ»ãƒ»ãƒ»ã€<br>é™¢å†…ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çŸ¥ã£ã¦ã„ã‚Œã°ã€ã“ã®ç­”ãˆã¯ã™ãã«ã‚ã‹ã‚‹ã¯ãšã ã€‚",
      title: "å¤–æ¥å—ä»˜ã®æ©Ÿæ¢°ãŒèµ·å‹•ã™ã‚‹æ™‚åˆ»ã¯æ¬¡ã®ã†ã¡ã©ã‚Œï¼Ÿ",
      choices: [
        {label:"7:45", correct:false},
        {label:"8:00", correct:false},
        {label:"8:15", correct:true},
        {label:"8:30", correct:false}
      ],
      explain: [
        "å¤–æ¥å—ä»˜ã®è‡ªå‹•æ©Ÿæ¢°ã¯8:15ã«èµ·å‹•ã€‚",
        "æ©Ÿæ¢°ã®ç¨¼åƒæ™‚é–“ã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨ã€æ‚£è€…å¯¾å¿œã‚„æ¡ˆå†…ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ã§ãã‚‹ã€‚"
      ]
    },
    {
      story: "ğŸ•µï¸â€â™€ï¸ ç¬¬3ã®è¬ï¼š8:15ã«ç¾ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸<br>ã‚ãªãŸã¯å¤–æ¥å—ä»˜ã®æ©Ÿæ¢°ãŒ8:15ã«èµ·å‹•ã™ã‚‹ç¬é–“ã‚’è¦‹å±Šã‘ãŸã€‚<br>ã™ã‚‹ã¨ã€ç”»é¢ã«ä¸€ç¬ã ã‘ã“ã‚“ãªæ–‡å­—ãŒè¡¨ç¤ºã•ã‚ŒãŸâ€•â€•<br>ã€Œ12æœˆãƒ»é™¢å†…ãƒãƒ¼ãƒ ãƒ»TMCã€<br>ã“ã‚Œã¯ä¸€ä½“ä½•ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ",
      title: "æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚",
      choices: [
        {label:"æ±ç”Ÿãƒãƒ©ã‚½ãƒ³ãƒãƒ£ãƒ¬ãƒ³ã‚¸", correct:false},
        {label:"ã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—", correct:true},
        {label:"é™¶ç”Ÿãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚³ãƒ³ã‚µãƒ¼ãƒˆ", correct:false},
        {label:"æ±äº¬ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã‚¯ã‚¤ã‚º", correct:false}
      ],
      explain: [
        "TMCã¯ã€Œã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ã€ã®ç•¥ã€‚",
        "é™¢å†…ã®å¤šè·ç¨®ãƒãƒ¼ãƒ ãŒç«¶ã„åˆã†ã€12æœˆæ’ä¾‹ã®ã‚¤ãƒ™ãƒ³ãƒˆã€‚",
        "çŸ¥è­˜ãƒ»æŠ€èƒ½ãƒ»ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒè©¦ã•ã‚Œã‚‹ç—…é™¢è¡Œäº‹ã€‚"
      ]
    }
  ];
  let quizIndex = 0;

  const quizImages = ["nazo1.png", "nazo2.png", "nazo3.png"];

  function renderQuiz(){
    const q = quiz[quizIndex];
    storyEl.innerHTML = q.story;

    quizImgEl.src = quizImages[quizIndex];
    quizImgEl.alt = `ç¬¬${quizIndex+1}ã®è¬`;

    qTitleEl.textContent = q.title;
    choicesEl.innerHTML = ""; judgeEl.textContent = "";
    explainEl.style.display = "none"; explainEl.innerHTML = "";
    nextArea.style.display = "none";

    q.choices.forEach(c=>{
      const b = document.createElement('button');
      b.className = 'choice-btn';
      b.textContent = c.label;
      b.onclick = ()=>judge(c.correct);
      choicesEl.appendChild(b);
    });
  }

  function showStamp(){ stampEl.style.display='flex'; setTimeout(()=>{ stampEl.style.display='none'; }, 700); }

  // â˜… ä¿®æ­£: æ­£è§£æ™‚ã¯ pinpon ã®ã¿ã‚’ç¢ºå®Ÿã«é³´ã‚‰ã™ï¼ˆpochiã‚’åœæ­¢ã—ã€ã‚ãšã‹ã«é…å»¶ã—ã¦å†ç”Ÿï¼‰
  function judge(isCorrect){
    if(isCorrect){
      judgeEl.textContent = "æ­£è§£ï¼";
      judgeEl.className = "result ok";

      // ã‚¯ãƒªãƒƒã‚¯SEã¨ç«¶åˆã—ãªã„ã‚ˆã†å¿µã®ãŸã‚å®Œå…¨åœæ­¢
      try{ seClick.pause(); seClick.currentTime = 0; }catch{}
      // BGMã«åŸ‹ã‚‚ã‚Œã‚„ã™ã„å ´åˆã¯ä¸€æ™‚çš„ã«ä¸‹ã’ã‚‹ï¼ˆä»»æ„ï¼‰ã€‚å¿…è¦ãªã‘ã‚Œã°ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§OKã€‚
      // const prevVol = bgm.volume ?? 0.8; try{ bgm.volume = 0.6; }catch{}

      try{
        seCorrect.currentTime = 0;
        setTimeout(()=>{ 
          seCorrect.play().catch(()=>{});
          // setTimeout(()=>{ try{ bgm.volume = prevVol; }catch{} }, 600); // ä»»æ„ã®å¾©å¸°
        }, 30);
      }catch{}

      showStamp();

      const q = quiz[quizIndex];
      explainEl.innerHTML = "<strong>è§£èª¬</strong><ul style='margin:6px 0 0; padding-left:18px;'>" +
        q.explain.map(t=>`<li>${t}</li>`).join("") + "</ul>";
      explainEl.style.display = "block";
      nextArea.style.display = "block";

    }else{
      judgeEl.textContent = "æ®‹å¿µï¼ã‚‚ã†ä¸€åº¦é¸ã‚“ã§ã¿ã‚ˆã†ã€‚";
      judgeEl.className = "result ng";
    }
  }

  // ç´™å¹é›ª
  function launchConfetti(){
    confettiEl.innerHTML = "";
    const colors = ["#ff7ac6","#ffd166","#7bdff2","#c3f0ca","#b5b0ff"];
    for(let i=0;i<40;i++){
      const s = document.createElement('span');
      const size = 8 + Math.random()*10;
      s.style.width = `${size}px`;
      s.style.height = `${size*1.6}px`;
      s.style.left = `${Math.random()*100}%`;
      s.style.background = colors[Math.floor(Math.random()*colors.length)];
      s.style.animationDelay = `${Math.random()*0.8}s`;
      s.style.opacity = 0.8 + Math.random()*0.2;
      confettiEl.appendChild(s);
    }
  }
  // ã‚­ãƒ©ã‚­ãƒ©
  function launchSparkles(){
    sparklesEl.innerHTML = "";
    for(let i=0;i<18;i++){
      const sp = document.createElement('div');
      sp.className = 'spark';
      sp.style.left = `${Math.random()*100}%`;
      sp.style.top  = `${Math.random()*100}%`;
      sp.style.animationDelay = `${Math.random()*1.2}s`;
      sparklesEl.appendChild(sp);
    }
  }

  // æ¬¡ã¸
  nextBtn.addEventListener('click', ()=>{
    if(++quizIndex < quiz.length){
      renderQuiz();
      window.scrollTo({top:0, behavior:'smooth'});
    }else{
      const nm = nameEl.value.trim() || "åæ¢åµ";
      endingText.innerHTML = `<strong>${nm}æ¢åµã€ã‚ã‚ŠãŒã¨ã†ï¼</strong><br>å›ã¯æœ¬å½“ã«åæ¢åµã‹ã‚‚ã—ã‚Œãªã„â€¦ã€‚<br>æ¬¡ã®è¬ã§ã¾ãŸä¼šãŠã†ã€‚`;
      show(screenEnding);
      // â˜… ã‚¯ãƒªã‚¢æ¼”å‡ºï¼šç´™å¹é›ªãƒ»ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ«ãƒ»æˆåŠŸSE
      launchConfetti();
      launchSparkles();
      try{ seClear.currentTime = 0; seClear.play(); }catch{}
      window.scrollTo({top:0, behavior:'smooth'});
    }
  });

  // çµ‚äº†ãƒœã‚¿ãƒ³ï¼šéŸ³ã‚’æ­¢ã‚ã¦ãŠç¤¼è¡¨ç¤º
  finishBtn.addEventListener('click', ()=>{
    stopAllSounds();
    finishMessage.style.display = 'block';
    finishBtn.disabled = true;
    finishBtn.textContent = 'çµ‚äº†ã—ã¾ã—ãŸ';
  });

  // BGMé–‹å§‹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«
  document.getElementById('begin-diag').addEventListener('click', ()=>{
    if(!bgmStarted){
      bgmStarted = true;
      try{ bgm.volume = 0.8; bgm.play(); }catch{}
    }
  });
</script>
</body>
</html>
